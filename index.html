<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ï‡∏±‡∏á (Full App)</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; }
        .container { max-width: 500px; margin: auto; padding: 20px; background-color: #fff; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        h2, h3 { text-align: center; }
        form { display: flex; flex-direction: column; gap: 15px; }
        input, button { padding: 10px; font-size: 16px; border-radius: 4px; border: 1px solid #ccc; }
        button { background-color: #007bff; color: white; border: none; cursor: pointer; }
        #status { text-align: center; margin-top: 15px; font-weight: bold; }
        .expense-item { list-style: none; display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; }
        .delete-btn { background-color: #dc3545; color: white; font-size: 12px; padding: 5px 8px; }
        #totalSpend { text-align: center; font-size: 1.2em; font-weight: bold; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h2>üí∏ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ (‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ï‡∏±‡∏á)</h2>
        <form id="expenseForm">
            <label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà:</label> <input type="text" id="category" required>
            <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó):</label> <input type="number" id="amount" required>
            <button type="submit" id="submitButton">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        </form>
        <p id="status"></p>
        <hr>
        <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>
        <ul id="expenseList"></ul>
        <div id="totalSpend"></div>
    </div>

    <script>
        // --- !!! ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç 3 URL ‡∏ô‡∏µ‡πâ ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏à‡∏≤‡∏Å API Gateway) !!! ---
        const API_ADD_URL = "https://YOUR_API_ID.execute-api.../default/addExpense";
        const API_GET_URL = "https://YOUR_API_ID.execute-api.../default/expenses";
        const API_DELETE_URL = "https://YOUR_API_ID.execute-api.../default/delete-expense";
        // -----------------------------------------------------------------

        const form = document.getElementById("expenseForm");
        const statusEl = document.getElementById("status");
        const listEl = document.getElementById("expenseList");
        const totalEl = document.getElementById("totalSpend");

        // 1. ‡∏î‡∏∂‡∏á‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
        async function fetchExpenses() {
            try {
                const response = await fetch(API_GET_URL, { method: "GET" });
                if (!response.ok) throw new Error("Failed to fetch list");
                const items = await response.json();
                renderList(items);
            } catch (error) { listEl.innerHTML = `<li style="color:red">Error loading list</li>`; }
        }
        
        // 2. ‡∏ß‡∏≤‡∏î List
        function renderList(items) {
            listEl.innerHTML = "";
            let total = 0;
            if (items.length === 0) listEl.innerHTML = "<li>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</li>";
            items.sort((a, b) => new Date(a.createdAt) - new Date(b.createdAt));
            items.forEach(item => {
                total += item.amount;
                const li = document.createElement("li");
                li.className = "expense-item";
                li.innerHTML = `<span>${item.category}: <strong>${item.amount}</strong> ‡∏ö‡∏≤‡∏ó</span>
                              <button class="delete-btn" onclick="deleteItem('${item.date_expense_id}')">‡∏•‡∏ö</button>`;
                listEl.appendChild(li);
            });
            totalEl.innerText = `‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ: ${total} ‡∏ö‡∏≤‡∏ó`;
        }
        
        // 3. ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
        async function deleteItem(date_expense_id) {
            if (!confirm("‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ô‡∏∞ ‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏•‡∏ö?")) return;
            statusEl.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö...";
            try {
                const response = await fetch(API_DELETE_URL, {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({ "date_expense_id": date_expense_id })
                });
                if (!response.ok) throw new Error("Failed to delete");
                statusEl.innerText = "‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!";
                fetchExpenses();
            } catch (error) { statusEl.innerText = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ï‡∏≠‡∏ô‡∏•‡∏ö: " + error.message; }
        }

        // 4. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
        form.addEventListener("submit", async function(e) {
            e.preventDefault();
            statusEl.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...";
            document.getElementById("submitButton").disabled = true;
            try {
                const response = await fetch(API_ADD_URL, {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({
                        "category": document.getElementById("category").value,
                        "amount": parseInt(document.getElementById("amount").value)
                    })
                });
                if (!response.ok) throw new Error("Server Error: " + response.status);
                const data = await response.json();
                statusEl.innerText = data.alertSent ? "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! (‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô!)" : "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!";
                form.reset();
                fetchExpenses(); // ‡πÇ‡∏´‡∏•‡∏î List ‡πÉ‡∏´‡∏°‡πà
            } catch (error) { statusEl.innerText = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + error.message; }
            finally { document.getElementById("submitButton").disabled = false; }
        });

        // 5. ‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡∏î‡∏∂‡∏á List ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
        window.addEventListener("DOMContentLoaded", fetchExpenses);
    </script>
</body>
</html>
